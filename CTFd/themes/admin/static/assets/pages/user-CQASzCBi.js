import{$ as e,V as w,C as c,O as d,u,N as g}from"./main-C_QlMNZg.js";import{c as p,u as m}from"../graphs-BiKk-BfX.js";import{C as y}from"../CommentBox-C6TBtqBO.js";import"../echarts.common-BdDHhU43.js";function b(n){n.preventDefault();const s=e("#user-info-create-form").serializeJSON(!0);s.fields=[];for(const o in s)if(o.match(/fields\[\d+\]/)){let a={},l=parseInt(o.slice(7,-1));a.field_id=l,a.value=s[o],s.fields.push(a),delete s[o]}let t="/api/v1/users";s.notify===!0&&(t=`${t}?notify=true`),delete s.notify,c.fetch(t,{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(o){return o.json()}).then(function(o){if(o.success){const a=o.data.id;window.location=c.config.urlRoot+"/admin/users/"+a}else e("#user-info-create-form > #results").empty(),Object.keys(o.errors).forEach(function(a,l){e("#user-info-create-form > #results").append(d({type:"error",body:o.errors[a]}));const r=e("#user-info-form").find("input[name={0}]".format(a)),f=e(r);f.addClass("input-filled-invalid"),f.removeClass("input-filled-valid")})})}function _(n){n.preventDefault();const s=e("#user-info-edit-form").serializeJSON(!0);s.fields=[];for(const t in s)if(t.match(/fields\[\d+\]/)){let i={},o=parseInt(t.slice(7,-1));i.field_id=o,i.value=s[t],s.fields.push(i),delete s[t]}c.fetch("/api/v1/users/"+window.USER_ID,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(t){t.success?window.location.reload():(e("#user-info-edit-form > #results").empty(),Object.keys(t.errors).forEach(function(i,o){e("#user-info-edit-form > #results").append(d({type:"error",body:t.errors[i]}));const a=e("#user-info-edit-form").find("input[name={0}]".format(i)),l=e(a);l.addClass("input-filled-invalid"),l.removeClass("input-filled-valid")}))})}function S(n){n.preventDefault(),u({title:"حذف کاربر",body:"مطمئنید که می‌خواهید حذف کنید: {0}".format("<strong>"+g(window.USER_NAME)+"</strong>"),success:function(){c.fetch("/api/v1/users/"+window.USER_ID,{method:"DELETE"}).then(function(s){return s.json()}).then(function(s){s.success&&(window.location=c.config.urlRoot+"/admin/users")})}})}function E(n){n.preventDefault();const s=e("#user-award-form").serializeJSON(!0);s.user_id=window.USER_ID,c.fetch("/api/v1/awards",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(t){t.success?window.location.reload():(e("#user-award-form > #results").empty(),Object.keys(t.errors).forEach(function(i,o){e("#user-award-form > #results").append(d({type:"error",body:t.errors[i]}));const a=e("#user-award-form").find("input[name={0}]".format(i)),l=e(a);l.addClass("input-filled-invalid"),l.removeClass("input-filled-valid")}))})}function C(n){n.preventDefault();var s=e("#user-mail-form").serializeJSON(!0);c.fetch("/api/v1/users/"+window.USER_ID+"/email",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(t){return t.json()}).then(function(t){t.success?(e("#user-mail-form > #results").append(d({type:"success",body:"E-Mail sent successfully!"})),e("#user-mail-form").find("input[type=text], textarea").val("")):(e("#user-mail-form > #results").empty(),Object.keys(t.errors).forEach(function(i,o){e("#user-mail-form > #results").append(d({type:"error",body:t.errors[i]}));var a=e("#user-mail-form").find("input[name={0}], textarea[name={0}]".format(i)),l=e(a);l.addClass("input-filled-invalid"),l.removeClass("input-filled-valid")}))})}function I(n){let t=e("input[data-submission-type=incorrect]:checked").map(function(){return e(this).data("submission-id")});t.length,u({title:"ثبت ارسال به عنوان درست",body:"آیا مطمئنید؟",success:function(){const i=[];for(var o of t){let a=c.fetch(`/api/v1/submissions/${o}`,{method:"PATCH",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({type:"correct"})});i.push(a)}Promise.all(i).then(a=>{window.location.reload()})}})}function h(n,s){let t,i,o;switch(s){case"solves":t=e("input[data-submission-type=correct]:checked"),i="solve",o="Solves";break;case"fails":t=e("input[data-submission-type=incorrect]:checked"),i="fail",o="Fails";break}let a=t.map(function(){return e(this).data("submission-id")});a.length===1||i+"",u({title:`حذف ${o}`,body:"آیا مطمئنید؟",success:function(){const l=[];for(var r of a)l.push(c.api.delete_submission({submissionId:r}));Promise.all(l).then(f=>{window.location.reload()})}})}function j(n){let s=e("input[data-award-id]:checked").map(function(){return e(this).data("award-id")});s.length,u({title:"حذف جوایز",body:"آیا مطمئنید؟ ",success:function(){const t=[];for(var i of s){let o=c.fetch("/api/v1/awards/"+i,{method:"DELETE",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}});t.push(o)}Promise.all(t).then(o=>{window.location.reload()})}})}function D(n){n.preventDefault();let s=e("input[data-missing-challenge-id]:checked").map(function(){return e(this).data("missing-challenge-id")}),t=s.length===1?"challenge":"challenges";u({title:"به عنوان صحیح علامت بزنید",body:`ایا مطمئنید که تعداد ${s.length} ${t} چالش را به عنوان درست علامت بزنید برای:  ${g(window.USER_NAME)}?`,success:function(){const i=[];for(var o of s){let a={provided:"MARKED AS SOLVED BY ADMIN",user_id:window.USER_ID,team_id:window.TEAM_ID,challenge_id:o,type:"correct"},l=c.fetch("/api/v1/submissions",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)});i.push(l)}Promise.all(i).then(a=>{window.location.reload()})}})}const v={team:[n=>c.api.get_team_solves({teamId:n}),n=>c.api.get_team_fails({teamId:n}),n=>c.api.get_team_awards({teamId:n})],user:[n=>c.api.get_user_solves({userId:n}),n=>c.api.get_user_fails({userId:n}),n=>c.api.get_user_awards({userId:n})]},k=(n,s,t,i)=>{let[o,a,l]=v[n];Promise.all([o(i),a(i),l(i)]).then(r=>{p("score_graph","#score-graph",r,n,s,t,i),p("category_breakdown","#categories-pie-graph",r,n,s,t,i),p("solve_percentages","#keys-pie-graph",r,n,s,t,i)})},O=(n,s,t,i)=>{let[o,a,l]=v[n];Promise.all([o(i),a(i),l(i)]).then(r=>{m("score_graph","#score-graph",r,n,s,t,i),m("category_breakdown","#categories-pie-graph",r,n,s,t,i),m("solve_percentages","#keys-pie-graph",r,n,s,t,i)})};e(()=>{e(".delete-user").click(S),e(".edit-user").click(function(r){e("#user-info-modal").modal("toggle")}),e(".award-user").click(function(r){e("#user-award-modal").modal("toggle")}),e(".email-user").click(function(r){e("#user-email-modal").modal("toggle")}),e(".addresses-user").click(function(r){e("#user-addresses-modal").modal("toggle")}),e("#user-mail-form").submit(C),e("#solves-delete-button").click(function(r){h(r,"solves")}),e("#correct-fail-button").click(I),e("#fails-delete-button").click(function(r){h(r,"fails")}),e("#awards-delete-button").click(function(r){j()}),e("#missing-solve-button").click(function(r){D(r)}),e("#user-info-create-form").submit(b),e("#user-info-edit-form").submit(_),e("#user-award-form").submit(E);const n=w.extend(y);let s=document.createElement("div");document.querySelector("#comment-box").appendChild(s),new n({propsData:{type:"user",id:window.USER_ID}}).$mount(s);let t,i,o,a;({type:t,id:i,name:o,account_id:a}=window.stats_data);let l;e("#user-statistics-modal").on("shown.bs.modal",function(r){k(t,i,o,a),l=setInterval(()=>{O(t,i,o,a)},3e5)}),e("#user-statistics-modal").on("hidden.bs.modal",function(r){clearInterval(l)}),e(".statistics-user").click(function(r){e("#user-statistics-modal").modal("toggle")})});
